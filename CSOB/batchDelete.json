//initializeVariable
{
    "id": "13dc37bc-8d4e-459d-8b29-49f42fce80fa",
    "brandColor": "#770BD6",
    "connectionReferences": {
        "shared_excelonlinebusiness": {
            "connection": {
                "id": "/providers/Microsoft.PowerApps/apis/shared_excelonlinebusiness/connections/shared-excelonlinebu-8d2660ba-6962-469f-86fd-5870296bf52f"
            }
        },
        "shared_sharepointonline": {
            "connection": {
                "id": "/providers/Microsoft.PowerApps/apis/shared_sharepointonline/connections/c6137399265648a9a2867541b84899b4"
            }
        }
    },
    "connectorDisplayName": "Variables",
    "icon": "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzJweCIgaGVpZ2h0PSIzMnB4IiBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCAzMiAzMiIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgMzIgMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+DQogPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiBmaWxsPSIjNzcwQkQ2Ii8+DQogPGcgZmlsbD0iI2ZmZiI+DQogIDxwYXRoIGQ9Ik02Ljc2MywxMy42ODV2LTMuMjA4QzYuNzYzLDguNzQ4LDcuNzYyLDgsMTAsOHYxLjA3Yy0xLDAtMiwwLjMyNS0yLDEuNDA3djMuMTg4ICAgIEM4LDE0LjgzNiw2LjUxMiwxNiw1LjUxMiwxNkM2LjUxMiwxNiw4LDE3LjE2NCw4LDE4LjMzNVYyMS41YzAsMS4wODIsMSwxLjQyOSwyLDEuNDI5VjI0Yy0yLjIzOCwwLTMuMjM4LTAuNzcyLTMuMjM4LTIuNXYtMy4xNjUgICAgYzAtMS4xNDktMC44OTMtMS41MjktMS43NjMtMS41ODV2LTEuNUM1Ljg3LDE1LjE5NCw2Ljc2MywxNC44MzQsNi43NjMsMTMuNjg1eiIvPg0KICA8cGF0aCBkPSJtMjUuMjM4IDEzLjY4NXYtMy4yMDhjMC0xLjcyOS0xLTIuNDc3LTMuMjM4LTIuNDc3djEuMDdjMSAwIDIgMC4zMjUgMiAxLjQwN3YzLjE4OGMwIDEuMTcxIDEuNDg4IDIuMzM1IDIuNDg4IDIuMzM1LTEgMC0yLjQ4OCAxLjE2NC0yLjQ4OCAyLjMzNXYzLjE2NWMwIDEuMDgyLTEgMS40MjktMiAxLjQyOXYxLjA3MWMyLjIzOCAwIDMuMjM4LTAuNzcyIDMuMjM4LTIuNXYtMy4xNjVjMC0xLjE0OSAwLjg5My0xLjUyOSAxLjc2Mi0xLjU4NXYtMS41Yy0wLjg3LTAuMDU2LTEuNzYyLTAuNDE2LTEuNzYyLTEuNTY1eiIvPg0KICA8cGF0aCBkPSJtMTUuODE1IDE2LjUxMmwtMC4yNDItMC42NDFjLTAuMTc3LTAuNDUzLTAuMjczLTAuNjk4LTAuMjg5LTAuNzM0bC0wLjM3NS0wLjgzNmMtMC4yNjYtMC41OTktMC41MjEtMC44OTgtMC43NjYtMC44OTgtMC4zNyAwLTAuNjYyIDAuMzQ3LTAuODc1IDEuMDM5LTAuMTU2LTAuMDU3LTAuMjM0LTAuMTQxLTAuMjM0LTAuMjUgMC0wLjMyMyAwLjE4OC0wLjY5MiAwLjU2Mi0xLjEwOSAwLjM3NS0wLjQxNyAwLjcxLTAuNjI1IDEuMDA3LTAuNjI1IDAuNTgzIDAgMS4xODYgMC44MzkgMS44MTEgMi41MTZsMC4xNjEgMC40MTQgMC4xOC0wLjI4OWMxLjEwOC0xLjc2IDIuMDQ0LTIuNjQxIDIuODA0LTIuNjQxIDAuMTk4IDAgMC40MyAwLjA1OCAwLjY5NSAwLjE3MmwtMC45NDYgMC45OTJjLTAuMTI1LTAuMDM2LTAuMjE0LTAuMDU1LTAuMjY2LTAuMDU1LTAuNTczIDAtMS4yNTYgMC42NTktMi4wNDggMS45NzdsLTAuMjI3IDAuMzc5IDAuMTc5IDAuNDhjMC42ODQgMS44OTEgMS4yNDkgMi44MzYgMS42OTQgMi44MzYgMC40MDggMCAwLjcyLTAuMjkyIDAuOTM1LTAuODc1IDAuMTQ2IDAuMDk0IDAuMjE5IDAuMTkgMC4yMTkgMC4yODkgMCAwLjI2MS0wLjIwOCAwLjU3My0wLjYyNSAwLjkzOHMtMC43NzYgMC41NDctMS4wNzggMC41NDdjLTAuNjA0IDAtMS4yMjEtMC44NTItMS44NTEtMi41NTVsLTAuMjE5LTAuNTc4LTAuMjI3IDAuMzk4Yy0xLjA2MiAxLjgyMy0yLjA3OCAyLjczNC0zLjA0NyAyLjczNC0wLjM2NSAwLTAuNjc1LTAuMDkxLTAuOTMtMC4yNzFsMC45MDYtMC44ODVjMC4xNTYgMC4xNTYgMC4zMzggMC4yMzQgMC41NDcgMC4yMzQgMC41ODggMCAxLjI1LTAuNTk2IDEuOTg0LTEuNzg2bDAuNDA2LTAuNjU4IDAuMTU1LTAuMjU5eiIvPg0KICA8ZWxsaXBzZSB0cmFuc2Zvcm09Im1hdHJpeCguMDUzNiAtLjk5ODYgLjk5ODYgLjA1MzYgNS40OTI1IDMyLjI0NSkiIGN4PSIxOS43NTciIGN5PSIxMy4yMjUiIHJ4PSIuNzc4IiByeT0iLjc3OCIvPg0KICA8ZWxsaXBzZSB0cmFuc2Zvcm09Im1hdHJpeCguMDUzNiAtLjk5ODYgLjk5ODYgLjA1MzYgLTcuNTgzOSAzMC42MjkpIiBjeD0iMTIuMzY2IiBjeT0iMTkuMzE1IiByeD0iLjc3OCIgcnk9Ii43NzgiLz4NCiA8L2c+DQo8L3N2Zz4NCg==",
    "isTrigger": false,
    "operationName": "Initialize_itemCount",
    "operationDefinition": {
        "type": "InitializeVariable",
        "inputs": {
            "variables": [
                {
                    "name": "itemCount",
                    "type": "integer",
                    "value": -1
                }
            ]
        },
        "runAfter": {},
        "metadata": {
            "operationMetadataId": "adba0fcc-3a1d-4170-89c5-101b2ad3f984"
        }
    }
}
//scope
{
    "id": "d6e8a445-e6b4-4089-ae2e-a0f787f958ff",
    "brandColor": "#8C3900",
    "connectionReferences": {
        "shared_excelonlinebusiness": {
            "connection": {
                "id": "/providers/Microsoft.PowerApps/apis/shared_excelonlinebusiness/connections/shared-excelonlinebu-8d2660ba-6962-469f-86fd-5870296bf52f"
            }
        },
        "shared_sharepointonline": {
            "connection": {
                "id": "/providers/Microsoft.PowerApps/apis/shared_sharepointonline/connections/c6137399265648a9a2867541b84899b4"
            }
        }
    },
    "connectorDisplayName": "Control",
    "icon": "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZlcnNpb249IjEuMSIgdmlld0JveD0iMCAwIDMyIDMyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPg0KIDxwYXRoIGQ9Im0wIDBoMzJ2MzJoLTMyeiIgZmlsbD0iIzhDMzkwMCIvPg0KIDxwYXRoIGQ9Im04IDEwaDE2djEyaC0xNnptMTUgMTF2LTEwaC0xNHYxMHptLTItOHY2aC0xMHYtNnptLTEgNXYtNGgtOHY0eiIgZmlsbD0iI2ZmZiIvPg0KPC9zdmc+DQo=",
    "isTrigger": false,
    "operationName": "Scope_-_batchDelete",
    "operationDefinition": {
        "type": "Scope",
        "actions": {
            "Do_until": {
                "type": "Until",
                "expression": "@equals(variables('itemCount'), 0)",
                "limit": {
                    "count": 60,
                    "timeout": "PT1H"
                },
                "actions": {
                    "Get_items": {
                        "type": "ApiConnection",
                        "inputs": {
                            "host": {
                                "connection": {
                                    "name": "@parameters('$connections')['shared_sharepointonline']['connectionId']"
                                }
                            },
                            "method": "get",
                            "path": "/datasets/@{encodeURIComponent(encodeURIComponent(outputs('settings')['siteAddress']))}/tables/@{encodeURIComponent(encodeURIComponent(outputs('settings')['listName']))}/items",
                            "queries": {
                                "$top": 1000
                            },
                            "authentication": "@parameters('$authentication')"
                        },
                        "runAfter": {},
                        "trackedProperties": {
                            "ItemCount": "@{length(body('Get_items')['value'])}"
                        },
                        "metadata": {
                            "flowSystemMetadata": {
                                "swaggerOperationId": "GetItems"
                            },
                            "operationMetadataId": "a8391d8f-e555-42d4-993a-5cd00dbd35eb"
                        }
                    },
                    "Select": {
                        "type": "Select",
                        "inputs": {
                            "from": "@body('Get_items')['value']",
                            "select": "@replace(outputs('Template'), '|ID|', string(item()['Id']))"
                        },
                        "runAfter": {
                            "Set_variable": [
                                "Succeeded"
                            ]
                        },
                        "description": "replace(outputs('Template'), '|ID|', string(item()['Id']))",
                        "metadata": {
                            "operationMetadataId": "620834c8-cfc2-448d-bb54-a94010b7d1d5"
                        }
                    },
                    "BatchDelete": {
                        "type": "Compose",
                        "inputs": "@join(body('Select'), decodeUriComponent('%0A'))",
                        "runAfter": {
                            "Select": [
                                "Succeeded"
                            ]
                        },
                        "description": "join(body('Select'), decodeUriComponent('%0A'))",
                        "metadata": {
                            "operationMetadataId": "96375de3-8841-4420-bf84-5c6134714ee1"
                        }
                    },
                    "Send_an_HTTP_request_to_SharePoint": {
                        "type": "ApiConnection",
                        "inputs": {
                            "host": {
                                "connection": {
                                    "name": "@parameters('$connections')['shared_sharepointonline']['connectionId']"
                                }
                            },
                            "method": "post",
                            "body": {
                                "method": "POST",
                                "uri": "/_api/$batch",
                                "headers": {
                                    "X-RequestDigest": "digest",
                                    "Content-Type": "multipart/mixed; boundary=batch_@{actions('settings')?['trackedProperties']['batchGUID']}"
                                },
                                "body": "--batch_@{actions('settings')?['trackedProperties']['batchGUID']}\nContent-Type: multipart/mixed; boundary=\"changeset_@{actions('settings')?['trackedProperties']['changeSetGUID']}\"\nContent-Length: @{length(outputs('BatchDelete'))}\nContent-Transfer-Encoding: binary\n\n@{outputs('BatchDelete')}\n--changeset_@{actions('settings')?['trackedProperties']['changeSetGUID']}--\n\n--batch_@{actions('settings')?['trackedProperties']['batchGUID']}--"
                            },
                            "path": "/datasets/@{encodeURIComponent(encodeURIComponent(outputs('settings')['siteAddress']))}/httprequest",
                            "authentication": "@parameters('$authentication')"
                        },
                        "runAfter": {
                            "BatchDelete": [
                                "Succeeded"
                            ]
                        },
                        "limit": {
                            "timeout": "P1D"
                        },
                        "metadata": {
                            "flowSystemMetadata": {
                                "swaggerOperationId": "HttpRequest"
                            },
                            "operationMetadataId": "73dc61fe-aebe-47d9-8555-43395ac2358c"
                        }
                    },
                    "Results": {
                        "type": "Compose",
                        "inputs": "@base64ToString(body('Send_an_HTTP_request_to_SharePoint')['$content'])",
                        "runAfter": {
                            "Send_an_HTTP_request_to_SharePoint": [
                                "Succeeded"
                            ]
                        },
                        "description": "base64ToString(body('Send_an_HTTP_request_to_SharePoint')['$content'])",
                        "metadata": {
                            "operationMetadataId": "30d24cf2-6f40-4f75-b5df-eaa632054521"
                        }
                    },
                    "Set_variable": {
                        "type": "SetVariable",
                        "inputs": {
                            "name": "itemCount",
                            "value": "@length(body('Get_items')['value'])"
                        },
                        "runAfter": {
                            "Get_items": [
                                "Succeeded"
                            ]
                        },
                        "metadata": {
                            "operationMetadataId": "d739c80d-a170-4c0f-bb6e-20dec879a9e4"
                        }
                    }
                },
                "runAfter": {
                    "Template": [
                        "Succeeded"
                    ]
                },
                "metadata": {
                    "operationMetadataId": "c89fc93d-b1e9-498b-9b04-88f06d09593c"
                }
            },
            "Template": {
                "type": "Compose",
                "inputs": "--changeset_@{actions('settings')?['trackedProperties']['changeSetGUID']}\nContent-Type: application/http\nContent-Transfer-Encoding: binary\n\nDELETE  @{outputs('settings')['siteAddress']}_api/web/lists/getByTitle('@{outputs('settings')['listName']}')/items(|ID|) HTTP/1.1\nContent-Type: application/json;odata=verbose\nAccept: application/json;odata=nometa\nIF-MATCH: *\n",
                "runAfter": {
                    "settings": [
                        "Succeeded"
                    ]
                },
                "metadata": {
                    "operationMetadataId": "c2011cea-93b8-4d40-b7a7-ce266dae03ca"
                }
            },
            "settings": {
                "type": "Compose",
                "inputs": {
                    "siteAddress": "https://kbcgroup.sharepoint.com/sites/csob-aplikace/240014/",
                    "listName": "M365SharedMailboxex"
                },
                "runAfter": {},
                "description": "list to batch delete items from",
                "trackedProperties": {
                    "batchGUID": "@{guid()}",
                    "changeSetGUID": "@{guid()}"
                },
                "metadata": {
                    "operationMetadataId": "9e178cb6-70b8-46f7-8b97-4fd92be35696"
                }
            }
        },
        "runAfter": {
            "Initialize_itemCount": [
                "Succeeded"
            ]
        },
        "description": "Delete items from SharePoint using the $batch API method",
        "metadata": {
            "operationMetadataId": "7a36e6f6-907b-454a-b532-65a334e64e3b"
        }
    }
}